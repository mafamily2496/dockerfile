(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"3cYC":function(e,t,i){"use strict";i.d(t,"a",function(){return l});var o=i("8Y7J"),r=i("6JEx"),s=(i("Ampu"),i("6xIq")),n=i("/Dxb"),a=i("royt"),c=i("e15G"),d=i("T53y"),h=i("SVse");class l{constructor(e,t,i,o,r,s){this.confirm=e,this.cookie=t,this.snapService=i,this.lang=o,this.date=r,this.examInfo=s}openStream(){return new Promise((e,t)=>{if(navigator&&window){if(!navigator.mediaDevices)return;navigator.mediaDevices.getUserMedia=navigator.mediaDevices.msGetUserMedia||navigator.mediaDevices.mozGetUserMedia||navigator.mediaDevices.webkitGetUserMedia||navigator.mediaDevices.getUserMedia,window.URL=window.msURL||window.mozURL||window.webkitURL||window.URL}else t("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5f55\u50cf");const i=t=>{this.stream=t,this.snapService.getDevices(),e()},o=e=>{this.confirm.error({nzCancelText:this.lang.useCHN?"\u53d6\u6d88":"Cancel",nzOkText:this.lang.useCHN?"\u786e\u5b9a":"Confirm",nzTitle:this.lang.useCHN?"\u9519\u8bef":"Error",nzContent:this.lang.useCHN?"\u6444\u50cf\u5934\u6253\u5f00\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u6444\u50cf\u5934\u5e76\u70b9\u51fb\u6d4f\u89c8\u5668\u5730\u5740\u680f\u53f3\u4fa7\u7684\u6444\u50cf\u5934\u6807\u5fd7\u8fdb\u884c\u5f00\u542f\u8bbe\u7f6e\u3002":"The camera failed to open. Please check the camera and click the camera icon on the right side of the browser address bar to enable the setting."}),Object(r.h)(new r.a(this.cookie.get("oxtoken"),location.href,"\u8003\u751f\u8fdb\u884c\u3010\u4eba\u8138\u8bc6\u522b\u3011\uff0c\u5931\u8d25\uff1a\u6253\u5f00\u6444\u50cf\u5934\u5931\u8d25\uff0c\u672a\u83b7\u53d6\u5230\u6444\u50cf\u5934\u6743\u9650[NotAllowedError]","\u7b14\u8bd5",`${this.examInfo.examId} - ${this.examInfo.examName} - ${this.examInfo.studentName}`,Object.assign({},r.b.getResult(),{timestamp:this.date.transform((new Date).getTime(),"yyyy-MM-dd HH:mm:ss")}))),t(e)};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.snapService.selectedConstraints).then(i).catch(o):navigator.getUserMedia({video:!0},i,o)})}snapShot(e,t,i=1){const r=new o.m;if(e){const o=e.nativeElement,s=o.getContext("2d"),n=t.nativeElement.offsetWidth,a=t.nativeElement.offsetHeight;if(o.width=n,o.height=a,s.drawImage(t.nativeElement,0,0,n,a),1===i){let t=e.nativeElement.toDataURL("image/png");t=t.substring(t.indexOf(",")+1),setTimeout(()=>r.emit(t),50)}else e.nativeElement.toBlob(e=>{r.emit(e)},"image/jpeg")}else r.emit(!1);return r}stopTrack(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null)}}l.ngInjectableDef=o.U({factory:function(){return new l(o.Y(c.f),o.Y(d.CookieService),o.Y(s.a),o.Y(n.a),o.Y(h.e),o.Y(a.a))},token:l,providedIn:"root"})},"6MUB":function(e,t,i){"use strict";var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,i,r){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(r){var s=encodeURIComponent(o(r))+i;return Array.isArray(e[r])?e[r].map(function(e){return s+encodeURIComponent(o(e))}).join(t):s+encodeURIComponent(o(e[r]))}).join(t):r?encodeURIComponent(o(r))+i+encodeURIComponent(o(e)):""}},"6xIq":function(e,t,i){"use strict";var o=i("mrSG"),r=i("AytR");class s{constructor(){this.img="",this.timestamp=Date.now(),this.countDown=0,this.pid=0,this.examId="0",this.photo="",this.oxToken=""}}var n=i("/Dxb"),a=i("TGJN"),c=(i("Ampu"),i("royt")),d=i("8Y7J"),h=i("IheW"),l=i("T53y");i.d(t,"a",function(){return m});class m{constructor(e,t,i,o){this.http=e,this.lang=t,this.cookie=i,this.exam=o,this.devices=[],this.selectedDevice="",this.uploading=0,this.rtcImageName=0,this.uploadingTotal=0,this.jsonObject=new s,this.getDevices()}get selectedConstraints(){let e={video:{deviceId:this.selectedDevice?{exact:this.selectedDevice}:void 0}};return(this.exam.videoMonitor||this.exam.rtcMonitor)&&(e.audio=!0),e}ngOnInit(){}initUpload(){this.SnapUploadUrl=r.a.ReportUrl+"/ojPhoto/upload",this.VideoUploadUrl=r.a.ReportUrl+"/schoolMonitor/addSlice",this.ossUpload=new a.a({url:`${r.a.ReportUrl}${this.exam.videoMonitor?"/schoolMonitor/auth":"/ojPhoto/ossAuth"}`,token:this.cookie.get("oxtoken")})}initRtcUpload(){this.ossUploadRtc=new a.a({url:`${r.a.ReportUrl}/realtime/uploadAuth`,token:this.cookie.get("oxtoken"),params:{examId:this.exam.examId}})}doUpLoad(e,t,i,r){return o.a(this,void 0,void 0,function*(){let t=(new Date).getTime()+".jpeg";try{yield this.ossUpload.uploadWithHttp(e,t),yield this.http.post(this.SnapUploadUrl,{fileName:t}).toPromise()}catch(i){this.exam.log({action:"\u76d1\u63a7",msg:`\u4eba\u8138\u622a\u56fe\u4e0a\u4f20\u5931\u8d25[${i.message}]`})}})}doUpLoadRtc(e){return o.a(this,void 0,void 0,function*(){this.rtcImageName=1==this.rtcImageName?0:1;let t=this.rtcImageName+".jpeg";try{yield this.ossUploadRtc.uploadWithHttp(e,t)}catch(i){this.exam.log({action:"\u76d1\u63a7",msg:`\u5b9e\u65f6\u76d1\u63a7\u622a\u56fe\u4e0a\u4f20\u5931\u8d25[${i.message}]`})}})}doUploadVideo(e,t,i){return o.a(this,void 0,void 0,function*(){try{this.uploading+=1,yield this.ossUpload.uploadWithHttp(e,t,{onUploadProgress:function(e){}}),this.http.post(this.VideoUploadUrl,{fileName:t,type:i}).toPromise()}catch(o){console.log("error::",o),this.exam.log({action:"\u76d1\u63a7",msg:"\u89c6\u9891\u4e0a\u4f20\u5931\u8d25",body:{fileName:t,type:i}})}finally{this.uploading-=1}})}getDevices(){return o.a(this,void 0,void 0,function*(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){if(!this.devices.some(e=>!!e.value))try{let t=yield navigator.mediaDevices.enumerateDevices();this.gotDevices(t)}catch(e){this.handleError(e)}}else this.handleError(new Error("\u4e0d\u652f\u6301 enumerateDevices() ."))})}gotDevices(e){this.devices=[];let t=this.lang.useCHN?"\u6444\u50cf\u5934":"Camera";for(let i=0;i!==e.length;++i){const o=e[i],r={value:o.deviceId,label:""};"audioinput"===o.kind||"audiooutput"===o.kind||("videoinput"===o.kind?(r.label=o.label||`${t} ${this.devices.length+1}`,this.devices.push(r),this.selectedDevice=this.devices[0].value):console.log("Some other kind of source/device: ",o))}this.exam.log({action:"\u8bbe\u5907\u68c0\u6d4b",msg:"devices-camera",body:this.devices})}handleError(e){console.error("enumerateDevices error: ",e.message,e.name),this.exam.log({action:"\u8bbe\u5907\u68c0\u6d4b",msg:"enumerateDevices error: "+e.message})}}m.ngInjectableDef=d.U({factory:function(){return new m(d.Y(h.c),d.Y(n.a),d.Y(l.CookieService),d.Y(c.a))},token:m,providedIn:"root"})},"8Mhf":function(e,t,i){"use strict";var o=i("3AA/"),r=i("PqYM"),s=(i("r8II"),i("MCLT")),n=i("AytR");class a{static getRoomId(e,t,i){return t=a.splitInterviewId(t),"-1"===(i=a.splitInterviewId(i))?"-1":e+this.SYMBOL+i}static splitInterviewId(e){return"string"!=typeof e&&(e=e.toString()||""),e.split(a.SYMBOL)[1]||e||""}static getInterviewId(e){return"string"!=typeof e&&(e=e.toString()||""),e.split(a.SYMBOL)[0]||e||""}static getReceiveId(e){return"string"!=typeof e&&(e=e.toString()||""),e.split(a.SYMBOL)[0]||e||""}static spliceId(e,t){return"string"!=typeof t&&(t=void 0===t?"":t.toString()),t.split(a.SYMBOL)[1]||t||""}static spliceInterviewId(e,t){return"string"!=typeof t&&(t=void 0===t?"":t.toString()),t.split(a.SYMBOL)[0]||t||""}static getTencentIntervieweeId(e){return e.split(this.SYMBOL)[1]||e||""}static handleStudentList(e,t){for(const i of e)i.intervieweeId=i.intervieweeId;return e}static getReconnectDelay(e){let t=5e3*Math.pow(2,e);{const e=Math.random(),i=Math.floor(.5*e*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,1e4)}static getBrowser(){const e={},t=navigator.userAgent.toLowerCase();let i;if(!this.isMobile()){const o=t.match(/chrome\/([\d.]+)/);window.showModalDialog&&window.chrome?e[360]=o?o[1]:"1.0":(i=t.match(/edge\/([\d.]+)/))?e.edge=i[1]:(i=t.match(/theworld ([\d.]+)/))?e.theworld=i[1]:(i=t.match(/qqbrowser\/([\d.]+)/))?e.qqbrowser=i[1]:(i=t.match(/lbbrowser/))?e.liebao=o?o[1]:"1.0":(i=t.match(/metasr ([\d.]+)/))?e.sougou=o?o[1]:"1.0":(i=t.match(/bidubrowser\/([\d.]+)/))?e.baidu=i[1]:(i=t.match(/rv:([\d.]+)\) like gecko/))?e.ie=i[1]:(i=t.match(/msie ([\d.]+)/))?e.ie=i[1]:(i=t.match(/firefox\/([\d.]+)/))?e.firefox=i[1]:(i=t.match(/chrome\/([\d.]+)/))?e.chrome=i[1]:(i=t.match(/opera.([\d.]+)/))?e.opera=i[1]:(i=t.match(/version\/([\d.]+).*safari/))&&(e.safari=i[1])}return e}static checkBrowserAndNavigate(){const e=n.a.BrowserErrorPage,t=this.getBrowser();this.isAllowedBrowser(Object.keys(t)[0],t[Object.keys(t)[0]])||this.isMobile()&&!this.isTech()||(location.href=e)}static isAllowedBrowser(e,t){return Object.keys(a.AllowedBrowser).indexOf(e)>-1&&(a.AllowedBrowser[e].ver[this.getSystem()]||0<=Number(t.toString().split(".")[0]))}static notCheckField(e){return console.log("field:",e),this.AllowedBrowser[Object.keys(this.getBrowser())[0]]&&this.AllowedBrowser[Object.keys(this.getBrowser())[0]].noCheckField.indexOf(e)>-1}static getHelpVideo(){return a.AllowedBrowser[Object.keys(a.getBrowser())[0]]?a.AllowedBrowser[Object.keys(a.getBrowser())[0]].videoUrl:a.AllowedBrowser.chrome.videoUrl}static getInnerHelpVideo(e){const t={tech:{},general:{}};return t.tech[2]="http://p0vvuf5m7.bkt.clouddn.com/interviewer_2.mp4",t.tech[1]="http://p0vvuf5m7.bkt.clouddn.com/interview_student_2.mp4",t.tech[3]="http://p0vvuf5m7.bkt.clouddn.com/interviewer_2.mp4",t.general[2]="http://p0vvuf5m7.bkt.clouddn.com/interviewer_1.mp4",t.general[1]="http://p0vvuf5m7.bkt.clouddn.com/interview_student_1.mp4",t.general[3]="http://p0vvuf5m7.bkt.clouddn.com/interviewer_1.mp4",t[a.getInterviewType()][e]}static isMobile(){const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}static addHelper(){const e=document.createElement("script");e.src="https://tb.53kf.com/code/code/10124917/1";const t=document.getElementsByTagName("script")[0];console.log("add 53::",e,t),t.parentNode.insertBefore(e,t)}static getInterviewType(){return location.href.indexOf("tech")>-1?"tech":"general"}static getSystem(){const e=navigator.platform;return 0===e.indexOf("Win")?"win":0===e.indexOf("Mac")?"mac":"X11"===e||0===e.indexOf("Linux")?"linux":"win"}static isTech(){return location.href&&location.href.indexOf("/tech")>-1}static convertToString(e){for(const t in e)Object(s.isNullOrUndefined)(e[t])||(e[t]=e[t].toString());return e}static isWechat(){return"undefined"!=typeof window&&"object"==typeof window.WeixinJSBridge&&"function"==typeof window.WeixinJSBridge.invoke}}a.SYMBOL="_",a.AUDIO_OUT="audiooutput",a.AUDIO_IN="audioinput",a.VIDEO_IN="videoinput",a.AllowedBrowser={chrome:{ver:{win:63,mac:63},noCheckField:[],videoUrl:"http://oyscztt0t.bkt.clouddn.com/interview_help_google.mp4",link:""},qqbrowser:{ver:{win:10,mac:4},noCheckField:[],videoUrl:"http://oyscztt0t.bkt.clouddn.com/interview_help_qq.mp4",link:"https://browser.qq.com/"},360:{ver:{win:55,mac:55},noCheckField:[],videoUrl:"http://oyscztt0t.bkt.clouddn.com/interview_help_360.mp4",link:"https://browser.360.cn/se/"},sougou:{ver:{win:55,mac:55},noCheckField:[a.AUDIO_OUT,a.AUDIO_IN,a.VIDEO_IN],videoUrl:" http://oyscztt0t.bkt.clouddn.com/interview_help_sogou.mp4",link:"https://ie.sogou.com/"},firefox:{ver:{win:61,mac:61},noCheckField:[a.AUDIO_OUT],videoUrl:"http://oyscztt0t.bkt.clouddn.com/interview_help_huohu.mp4",link:"https://ie.sogou.com/"}};var c=i("/Dxb"),d=i("royt"),h=(i("Ampu"),i("6JEx")),l=i("QhmR"),m=i("8Y7J"),u=i("iInd"),p=i("IheW"),g=i("T53y"),v=i("SVse");i.d(t,"a",function(){return b});class b{constructor(e,t,i,o,r,s,n){this.active=e,this.paper=t,this.http=i,this.examInfo=o,this.lang=r,this.cookie=s,this.date=n,this.startCountBlur()}autoSubmitOverMaxBlurCount(){return this.paper.getCurrentDirectoryBanOutNum()>0}startCountBlur(){this.blurTime=0,this.normalCount=0,this.programCount=0,this.paper.getStoreEvent.subscribe(e=>{this.setCurrentDirectoryBlurCount(e.outNum||0)}),this}countBlur(e){const t=e=>{console.log("\u5207\u51fa\u65f6\u957f",e,"ms"),this.logAnswerRecord(`\u8003\u751f\u56de\u5230\u7b54\u9898\u9875\u9762\uff0c\u79bb\u5f00\u65f6\u957f\uff1a${this.formatTime(e)}`),e>2900?(this.setCurrentDirectoryBlurCount(this.currentDirectoryBlurCount()+1),this.http.post("examing/countOut",{examPaperId:this.paper.examPaperId,directoryId:this.paper.isInIndex?0:this.paper.currentDirectory().directoryId,count:!0,outTime:e},{observe:"body",responseType:"json"}).subscribe(e=>{if(!this.paper.isEnded)if(e.flag)if(this.setCurrentDirectoryBlurCount(Number(e.data)),this.currentDirectoryBlurCount()>this.paper.getCurrentDirectoryBanOutNum()&&this.autoSubmitOverMaxBlurCount()&&this.needForceSubmit()){const e=this.lang.useCHN?"\u7531\u4e8e\u60a8\u7684\u8df3\u51fa\u6b21\u6570\u8fc7\u591a\uff0c\u4e0d\u7b26\u5408\u4f01\u4e1a\u8981\u6c42\uff0c\u8bd5\u5377\u5c06\u57285\u79d2\u949f\u4e4b\u540e\u88ab\u81ea\u52a8\u63d0\u4ea4\u3002":"Because you have too many bounces and do not meet the requirements of the company, the test paper will be submitted automatically after 5 seconds.";this.paper.submitCurrent(),this.paper.submitUploadEvent.emit({msg:"\u8df3\u51fa\u6b21\u6570\u8fc7\u591a, \u81ea\u52a8\u63d0\u4ea4"}),this.logAnswerRecord("\u7cfb\u7edf\u5f3a\u5236\u4ea4\u5377\uff0c\u539f\u56e0\uff1a\u79bb\u5f00\u7b54\u9898\u9875\u9762\u8d85\u51fa\u9650\u5b9a\u6b21\u6570");const t=this.paper.alertBlur(e,()=>{this.paper.DoSubmitAll(1),this.timer.unsubscribe()});this.timer=Object(r.a)(5e3).subscribe(()=>{this.paper.DoSubmitAll(1),t.close()})}else{let e=[`\u5207\u51fa\u9875\u9762\u88ab\u8bb0\u5f55${this.currentDirectoryBlurCount()}\u6b21\uff01`,this.autoSubmitOverMaxBlurCount()&&this.needForceSubmit()?`\u8d85\u8fc7${this.paper.getMaxOutNumber()}\u6b21\u8bd5\u5377\u5c06\u81ea\u52a8\u63d0\u4ea4`:"","\u6e29\u99a8\u63d0\u793a\uff1a\u8df3\u51fa\u5f53\u524d\u9875\u9762\u6253\u5f00\u5176\u4ed6\u6807\u7b7e / \u6d4f\u89c8\u5668\u3001\u6253\u5f00QQ\u5fae\u4fe1\u7b49\u5bf9\u8bdd\u7a97\u53e3\u3001\u8c03\u6574\u7f51\u7edc\u8bbe\u7f6e\u3001\u542f\u7528F\u529f\u80fd\u952e\u3001\u6d4f\u89c8\u5668\u81ea\u52a8\u8df3\u51fa\u5e7f\u544a\u7b49\u60c5\u51b5\u90fd\u5c06\u88ab\u8bc6\u522b\u4e3a\u5207\u51fa\uff0c\u8bf7\u5173\u95ed\u76f8\u5173\u8f6f\u4ef6\u548c\u529f\u80fd\uff0c\u907f\u514d\u8bef\u8bb0\u5f55\u3002"].join("\n");this.lang.useCHN||(e=[`Cut out page is recorded ${this.currentDirectoryBlurCount()} times\uff01`,this.autoSubmitOverMaxBlurCount()&&this.needForceSubmit()?`More than ${this.paper.getMaxOutNumber()} times test papers will be submitted automatically`:"","Tips: Jumping out of the current page to open other tabs / browsers, opening QQ WeChat and other dialog windows, adjusting network settings, enabling F function keys, and browsers automatically popping out ads will be recognized as cut out, please close related software and functions To avoid false records."].join("\n")),this.logAnswerRecord(`\u8003\u751f\u79bb\u5f00\u7b54\u9898\u9875\u9762\uff08${this.currentDirectoryBlurCount()}/${this.paper.getMaxOutNumber()}\u6b21\uff09\uff0c\u6240\u5728\u9875\u9762\uff1a${this.paper.isInIndex?"\u76ee\u5f55\u9875":l.e[String(this.paper.currentQuestion().subjectType)].title}`),this.paper.alertBlur(e)}else 1e3!=e.code&&this.paper.handleInfoError(e)})):console.warn("\u65f6\u95f4\u8fc7\u77ed\uff0c\u6682\u4e0d\u8ba1\u7b97")},i=(e,i)=>{const o=i-e;this.blurTime=0,this.paper.getCurrentDirectoryBanOutNum()>0&&t(o)};if(e)this.blurTime=Date.now();else if(this.blurTime>0){const e=Date.now();i(this.blurTime,e)}}currentDirectoryBlurCount(){return this.paper.ChooseCurrentOut(this.programCount,this.normalCount)}needForceSubmit(){let e=this.paper.currentDirectory();return e&&0===e.type?this.examInfo.banOutProblemForceSubmit:this.examInfo.banOutForceSubmit}setCurrentDirectoryBlurCount(e){const t=this.paper.chooseCurrentOutType("programCount","normalCount");t&&(this[t]=e)}removeListeners(){if(a.isMobile()){let e,t,i;void 0!==document.hidden?(e="hidden",i="visibilitychange",t="visibilityState"):void 0!==document.mozHidden?(e="mozHidden",i="mozvisibilitychange",t="mozVisibilityState"):void 0!==document.msHidden?(e="msHidden",i="msvisibilitychange",t="msVisibilityState"):void 0!==document.webkitHidden&&(e="webkitHidden",i="webkitvisibilitychange",t="webkitVisibilityState"),document.removeEventListener(i,this.event,!1)}else window.onblur=null,window.onfocus=null}{const e=e=>{if(!this.paper.isInQuestion()&&!this.paper.isInIndex||0===this.paper.getCurrentDirectoryBanOutNum()||document&&"iframe"===document.activeElement.tagName.toLowerCase())return!1;this.countBlur(!0)},t=e=>(this.samePageCopy=!1,this.countNotThisTime?(console.log("\u8be5\u6b21\u4e0d\u8ba1"),this.countNotThisTime=!1,!1):!(!this.paper.isInQuestion()&&!this.paper.isInIndex||0===this.paper.getCurrentDirectoryBanOutNum())&&void this.countBlur(!1));if(a.isMobile()){let i,o,r;void 0!==document.hidden?(i="hidden",r="visibilitychange",o="visibilityState"):void 0!==document.mozHidden?(i="mozHidden",r="mozvisibilitychange",o="mozVisibilityState"):void 0!==document.msHidden?(i="msHidden",r="msvisibilitychange",o="msVisibilityState"):void 0!==document.webkitHidden&&(i="webkitHidden",r="webkitvisibilitychange",o="webkitVisibilityState"),this.event=(r=>{document[o]===i?e():t()}),document.addEventListener(r,this.event,!1)}else window.onblur=e,window.onfocus=t}formatTime(e,t=!0){if(e<=0)return"0\u52060\u79d2";t&&(e=~~(e/1e3));let i=e%60,o=~~(e/60)%60;return`${o>9?""+o:"0"+o}\u5206${i>9?""+i:"0"+i}\u79d2`}logAnswerRecord(e){Object(h.h)(new h.a(this.cookie.get("oxtoken"),location.href,e,"\u7b14\u8bd5",`${this.examInfo.examId} - ${this.examInfo.examName} - ${this.examInfo.studentName}`,Object.assign({},h.b.getResult(),{timestamp:this.date.transform((new Date).getTime(),"yyyy-MM-dd HH:mm:ss")})))}}b.ngInjectableDef=m.U({factory:function(){return new b(m.Y(u.a),m.Y(o.a),m.Y(p.c),m.Y(d.a),m.Y(c.a),m.Y(g.CookieService),m.Y(v.e))},token:b,providedIn:"root"})},Dlr0:function(e,t,i){"use strict";i.d(t,"a",function(){return o});class o{constructor(e){this.sanitizer=e}transform(e,t){if(void 0!==e){const t="#*#";new RegExp(`${t}.*?${t}`,"g");let i=e.split(t);return i=i.map((e,t)=>t%2>0&&window.katex?window.katex.renderToString(e):e).join(""),this.sanitizer.bypassSecurityTrustHtml(i.replace(/<(script).*?>|<(\/script).*?>/gi,"< $1>"))}return""}}},TH6B:function(e,t,i){"use strict";i.d(t,"a",function(){return o});class o{}},YcCt:function(e,t,i){"use strict";function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,i,r){i=i||"=";var s={};if("string"!=typeof e||0===e.length)return s;var n=/\+/g;e=e.split(t=t||"&");var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var d=0;d<c;++d){var h,l,m,u,p=e[d].replace(n,"%20"),g=p.indexOf(i);g>=0?(h=p.substr(0,g),l=p.substr(g+1)):(h=p,l=""),m=decodeURIComponent(h),u=decodeURIComponent(l),o(s,m)?Array.isArray(s[m])?s[m].push(u):s[m]=[s[m],u]:s[m]=u}return s}},r8II:function(e,t,i){"use strict";t.decode=t.parse=i("YcCt"),t.encode=t.stringify=i("6MUB")},"yd+P":function(e,t,i){"use strict";i.d(t,"a",function(){return y});var o=i("mrSG"),r=i("6JEx"),s=(i("Ampu"),i("XNiG")),n=i("PqYM"),a=i("l5mm"),c=i("AytR"),d=i("3AA/"),h=i("8Mhf"),l=i("/Dxb"),m=i("TGJN"),u=i("royt"),p=i("BrTr"),g=i("8Y7J"),v=i("T53y"),b=i("IheW"),w=i("e15G"),f=i("SVse");class y{constructor(e,t,i,r,a,d,h,l){this.cookie=e,this.http=t,this.modal=i,this.paper=r,this.blurListener=a,this.lang=d,this.exam=h,this.date=l,this.recordConfig={mimeType:"video/webm",audioBitsPerSecond:128e3,videoBitsPerSecond:5e5},this.uploading=0,this.recordTime=6e4,this.watcherInit=!1,this.uploadingTotal=0,this.reOpenShare=(()=>{this.getScreenMedia()}),this.uploadNow=(()=>{const e=new s.a;Object(n.a)(3e3).subscribe(()=>!e.closed&&e.next(!1)),this.video||e.next(!1);const t=`${c.a.ReportUrl}/schoolCheatJudge/upload`,i=this.video.nativeElement;let r=document.createElement("canvas");r.width=1*i.videoWidth,r.height=1*i.videoHeight;let a=r.getContext("2d");return a.drawImage(i,0,0,r.width,r.height),r.toBlob(i=>o.a(this,void 0,void 0,function*(){let o=(new Date).getTime()+".jpg";try{if(!i)throw new Error("\u622a\u5c4f\u751f\u6210\u56fe\u7247\u5931\u8d25");if(console.log("screen:"+i.size),!(i.size>=8192))throw new Error("\u622a\u5c4f\u6570\u636e\u5f02\u5e38\uff0c\u56fe\u7247\u592a\u5c0f");yield this.ossUpload.uploadWithHttp(i,o),yield this.http.post(t,{fileName:o}).toPromise(),e.next(!0)}catch(s){e.next(!1),console.error(s.message),this.paper.submitLogger({action:"\u76d1\u63a7",msg:"\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1a"+s.message,agent:navigator.userAgent,body:i?i.size:0})}finally{a.clearRect(0,0,r.width,r.height)}}),"image/jpeg",.9),e}),this.paper.examEndEvent.subscribe(e=>{this.stopShare()})}startScreeonShot(e){return o.a(this,void 0,void 0,function*(){this.stream&&this.stream.active&&!e||(yield this.getScreenMedia())})}getScreenMedia(){return o.a(this,void 0,void 0,function*(){const e={video:{displaySurface:"monitor",logicalSurface:!0,frameRate:5,cursor:"always",width:1280,height:720}};let t;try{if(this.stopStream(),(this.paper.isInQuestion()||this.paper.isInIndex)&&(this.blurListener.countNotThisTime=!0),navigator.mediaDevices.getDisplayMedia)t=navigator.mediaDevices.getDisplayMedia(e);else if(navigator.getDisplayMedia)t=navigator.getDisplayMedia(e);else{this.shareState=2;let e=this.lang.useCHN?"\u6211\u4eec\u68c0\u6d4b\u5230\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5c4f\u5e55\u5f55\u5236\uff0c\u8bf7\u4e0b\u8f7d\u6211\u4eec\u63a8\u8350\u7684\u6700\u65b0Chrome\u6d4f\u89c8\u5668":"Your browser does not support screen recording, please download the latest Chrome browser we recommend";this.modal.error({nzTitle:this.lang.useCHN?"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301":"Browser does not support",nzContent:this.errorTemplate||e}),this.paper.submitLogger({action:"\u76d1\u63a7",msg:"\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301",body:navigator.userAgent})}const o=yield t;this.stream=o;let s=1;if(this.stream&&this.stream.getVideoTracks()&&this.stream.getVideoTracks()[0]&&!this.isFullScreen(this.stream)){s=3;let e="\u5c4f\u5e55\u9009\u62e9\u4e0d\u7b26\u5408\u8981\u6c42",t="\u60a8\u9009\u62e9\u7684\u5206\u4eab\u8303\u56f4\u5e76\u975e\u201c\u6574\u4e2a\u5c4f\u5e55\u201d\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u5f55\u5236\u6574\u4e2a\u7535\u8111\u5c4f\u5e55",i="\u91cd\u65b0\u9009\u62e9",o="\u62d2\u7edd\u91cd\u65b0\u6253\u5f00\u5c4f\u5e55\u5f55\u5236";this.lang.useCHN||(e="Screen selection does not meet requirements",t='The sharing range you selected is not "full screen", please choose to record the entire computer screen again',i="Reselect",o="Refuse to reopen screen recording"),this.modal.confirm({nzTitle:e,nzContent:t,nzOkText:i,nzCancelText:null,nzOnOk:()=>this.reOpenShare(),nzOnCancel:()=>Object(r.h)(new r.a(this.cookie.get("oxtoken"),location.href,o,navigator.userAgent,"",{timestamp:(new Date).getTime(),type:"select not monitor"}))}),this.logAnswerRecord("\u8003\u751f\u8fdb\u884c\u3010\u5c4f\u5e55\u5206\u4eab\u3011\uff0c\u5931\u8d25\uff1a\u672a\u9009\u62e9\u201c\u6574\u4e2a\u5c4f\u5e55\u201d"),this.paper.submitLogger({action:"\u76d1\u63a7",msg:"\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1a\u5206\u4eab\u8303\u56f4\u5e76\u975e\u201c\u6574\u4e2a\u5c4f\u5e55\u201d",body:navigator.userAgent})}this.stream.oninactive=(e=>{let t="\u5c4f\u5e55\u5f55\u5236\u4e2d\u65ad",i="\u6211\u4eec\u68c0\u6d4b\u5230\u60a8\u7684\u5c4f\u5e55\u5f55\u5236\u5df2\u7ecf\u4e2d\u65ad\uff0c\u53ef\u80fd\u662f\u60a8\u505c\u6b62\u4e86\u5c4f\u5e55\u5f55\u5236\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u5c4f\u5e55\u5f55\u5236",o="\u91cd\u65b0\u9009\u62e9",s="\u62d2\u7edd\u91cd\u65b0\u6253\u5f00\u5c4f\u5e55\u5f55\u5236";this.lang.useCHN||(t="Screen recording interrupted",i="Screen recording has been interrupted. It may be that you stopped the screen recording. Please reopen the screen recording",o="Reselect",s="Refuse to reopen screen recording"),this.shareState=2,this.stopRecord(),this.modal.confirm({nzTitle:t,nzContent:i,nzOkText:o,nzCancelText:null,nzOnOk:()=>this.reOpenShare(),nzOnCancel:()=>Object(r.h)(new r.a(this.cookie.get("oxtoken"),location.href,s,navigator.userAgent,"",{timestamp:e.timeStamp,type:e.type}))}),Object(r.h)(new r.a(this.cookie.get("oxtoken"),location.href,"screen stream inactive",navigator.userAgent,"",{timestamp:e.timeStamp,type:e.type})),this.paper.submitLogger({action:"\u76d1\u63a7",msg:"\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1a\u5c4f\u5e55\u5f55\u5236\u4e2d\u65ad",body:navigator.userAgent})}),this.exam.screenRecord&&this.watcherInit&&this.createRecorder(this.stream),this.stream.onremovetrack=((...e)=>{console.error(e)}),this.shareState=s,this.paper.submitLogger({action:"\u76d1\u63a7",msg:`\u5c4f\u5e55\u76d1\u63a7\uff1a\u5f00\u542f\u72b6\u6001[${this.shareState}]${1===this.shareState?"\u6210\u529f":"\u5f02\u5e38"}`}),1===this.shareState&&this.logAnswerRecord("\u8003\u751f\u8fdb\u884c\u3010\u5c4f\u5e55\u5206\u4eab\u3011\uff0c\u6210\u529f")}catch(i){this.shareState=2,this.stopRecord(),console.error("\u5f55\u5c4f\u9519\u8bef",i);const{message:e}=i;this.logAnswerRecord("\u8003\u751f\u8fdb\u884c\u3010\u5c4f\u5e55\u5206\u4eab\u3011\uff0c\u5931\u8d25\uff1a\u53d6\u6d88\u5206\u4eab[open display media error]"),this.paper.submitLogger({action:"\u76d1\u63a7",msg:"\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1a"+e,agent:navigator.userAgent,body:i})}})}logAnswerRecord(e){Object(r.h)(new r.a(this.cookie.get("oxtoken"),location.href,e,"\u7b14\u8bd5",`${this.exam.examId} - ${this.exam.examName} - ${this.exam.studentName}`,Object.assign({},r.b.getResult(),{timestamp:this.date.transform((new Date).getTime(),"yyyy-MM-dd HH:mm:ss")})))}initUpload(){this.exam.screenMonitor&&(this.ossUpload=new m.a({url:`${c.a.ReportUrl}/schoolCheatJudge/ossAuth`,token:this.cookie.get("oxtoken")}),this.screenShotInterval&&!this.screenShotInterval.closed||(this.screenShotInterval=Object(a.a)(45e3).subscribe(()=>{1===this.shareState&&this.stream&&this.stream.active&&this.video?this.uploadNow():this.paper.submitLogger({action:"\u76d1\u63a7",msg:`\u5c4f\u5e55\u76d1\u63a7\u5f02\u5e38\uff1ashareState-${this.shareState}, stream-${this.stream?"ok":"no"}, streamActive-${this.stream&&this.stream.active?"yes":"no"}, video-${this.video?"yes":"no"}`,body:navigator.userAgent})}))),this.exam.screenRecord&&(this.ossUploadVideo=new m.a({url:`${c.a.ReportUrl}/schoolMonitor/auth`,token:this.cookie.get("oxtoken")}),this.videoUploadUrl=c.a.ReportUrl+"/schoolMonitor/addSlice",this.watcherInit=!0,this.createRecorder(this.stream))}createRecorder(e){try{this.recorder&&(this.recorder.stop(),this.recorder=null),this.recorder=new p.a(e,this.recordConfig,{type:"video",ondataavailable:e=>{if(e.data&&e.data.size>10240){console.log("screen record:",e.data.size);let t="_screen.mp4",i=(new Date).getTime()+t,o=new File([e.data],i,{type:"video/mp4"});this.doUploadVideo(o,i,"screen")}}}),this.recorder.start(),clearInterval(this.recordTimer),this.recordTimer=setInterval(()=>{this.recorder.stop(),this.recorder.start()},this.recordTime)}catch(t){console.error(t.message),this.exam.log({action:"\u76d1\u63a7",msg:"\u89c6\u9891\u76d1\u63a7\u5f02\u5e38\uff1a"+t.message,angent:navigator.userAgent})}}stopRecord(){this.recorder&&(this.recorder.stop(),clearInterval(this.recordTimer))}doUploadVideo(e,t,i){return o.a(this,void 0,void 0,function*(){try{this.uploading+=1,yield this.ossUploadVideo.uploadWithHttp(e,t,{onUploadProgress:function(e){}}),this.http.post(this.videoUploadUrl,{fileName:t,type:i}).toPromise()}catch(o){this.exam.log({action:"\u76d1\u63a7",msg:"\u89c6\u9891\u4e0a\u4f20\u5931\u8d25",body:{fileName:t,type:i}})}finally{this.uploading-=1}})}openShare(e){return this.startScreeonShot(e)}stopShare(){if(this.exam.screenRecord&&(this.stopRecord(),clearInterval(this.recordTimer),this.recordTimer=null),this.screenShotInterval){const e=this.uploadNow().subscribe(()=>{this.stopStream(),e.unsubscribe()});this.screenShotInterval.unsubscribe()}else this.stopStream()}isAbnormal(){return this.statusAbnormal()}statusAbnormal(){return 1!==this.shareState}screenAbnormal(){return 3===this.shareState}stopStream(){this.stream&&(this.stream.oninactive=null,this.stream.getTracks().forEach(e=>e.stop()),this.stream=null,this.stopRecord())}isFullScreen(e){const t=e.getVideoTracks()[0];return t.getCapabilities?t.getCapabilities().deviceId.indexOf("screen")>-1:t.label&&(0===t.label.toLocaleLowerCase().indexOf("screen")||0===t.label.toLocaleLowerCase().indexOf("primary"))}}y.ngInjectableDef=g.U({factory:function(){return new y(g.Y(v.CookieService),g.Y(b.c),g.Y(w.f),g.Y(d.a),g.Y(h.a),g.Y(l.a),g.Y(u.a),g.Y(f.e))},token:y,providedIn:"root"})}}]);
